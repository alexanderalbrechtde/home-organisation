<?php

//dd(get_defined_vars());
//dd(rooms);
require_once(__DIR__ . '/header.phtml');
?>

    <div class="container">

        <section class="card card--warehouse-form">
            <div class="card__header">
                <h1>Lager</h1>
                <p class="muted">Füge neue Haushaltsgegenstände hinzu und behalte den aktuellen Bestand im Auge!</p>
            </div>

            <div class="card__body">
                <h2 class="section-title">Zum Lager hinzufügen</h2>

                <form action="/warehouse-submit" method="post" class="item-form">
                    <div class="form-group">
                        <label for="name">Titel</label>
                        <input type="text" id="name" name="name" maxlength="30">
                    </div>

                    <div class="form-group">
                        <label for="category">Kategorie</label>
                        <input type="text" id="category" name="category" maxlength="30">
                    </div>

                    <div class="form-group">
                        <label for="amount">Anzahl</label>
                        <input type="number" id="amount" name="amount" min="1">
                    </div>

                    <div class="form-group">
                        <label for="room_id">Raum</label>
                        <select id="room_id" name="room_id" required>
                            <option value="" disabled selected>Bitte wählen…</option>
                            <?php
                            if (!empty($rooms)): ?>
                                <?php
                                foreach ($rooms as $r): ?>
                                    <option value="<?= htmlspecialchars($r['name']) ?>">
                                        <?= htmlspecialchars($r['name']) ?>
                                    </option>
                                <?php
                                endforeach; ?>
                            <?php
                            else: ?>
                                <option value="" disabled>Keine Räume vorhanden</option>
                            <?php
                            endif; ?>
                        </select>
                    </div>

                    <button type="submit" class="btn">Speichern</button>
                </form>
            </div>
        </section>

        <section class="card card--warehouse-stock">
            <div class="card__header">
                <h2>Aktueller Bestand</h2>
            </div>

            <div class="card__body">
                <table class="stock-table">
                    <thead>
                    <tr>
                        <th>Titel</th>
                        <th>Kategorie</th>
                        <th>Menge</th>
                        <th>Raum</th>
                    </tr>
                    </thead>
                    <tbody>
                    <?php
                    if (!empty($items)): ?>
                        <?php
                        foreach ($items as $row): ?>
                            <tr>
                                <td><?= htmlspecialchars($row['name']) ?></td>
                                <td><?= htmlspecialchars($row['category']) ?></td>
                                <td><?= (int)$row['amount'] ?></td>
                                <td><?= htmlspecialchars($row['room_name'] ?? ($row['room'] ?? ($row['room_id'] ?? '—'))) ?></td>
                            </tr>
                        <?php
                        endforeach; ?>
                    <?php
                    else: ?>
                        <tr>
                            <td colspan="4" class="is-empty">Keine Einträge vorhanden</td>
                        </tr>
                    <?php
                    endif; ?>
                    </tbody>
                </table>
            </div>
        </section>

    </div>

<?php
require_once(__DIR__ . '/footer.phtml');
?>