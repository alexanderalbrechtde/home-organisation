<?php

require_once(__DIR__ . '/header.phtml');
?>

    <div class="rooms-wrapper">
        <div class="rooms">
            <h1>Meine Räume</h1>
            <form method="post" action="/rooms-submit">
                <div>
                    <label for="room_name">Raumname:</label>
                    <input type="text" id="room_name" name="room_name">
                </div>
                <div>
                    <label for="room_description">Beschreibung:</label>
                    <textarea id="room_description" name="room_description"></textarea>
                </div>
                <div>
                    <button type="submit">Raum erstellen</button>
                    <input type="hidden" name="room_id"
                           value="<?= isset($room['id']) ? htmlspecialchars($room['id']) : '' ?>">
                </div>
            </form>
            <?php
            $errors = $_SESSION['flashMessages'] ?? [];
            unset($_SESSION['flashMessages']);
            ?>

            <?php if (!empty($errors)): ?>
                <div class="error-messages">

                    <?php foreach ($errors as $field => $messages): ?>
                        <h3><?= htmlspecialchars($field) ?></h3>
                        <ul>
                            <?php foreach ($messages as $msg): ?>
                                <li><?= htmlspecialchars($msg) ?></li>
                            <?php endforeach; ?>
                        </ul>
                    <?php endforeach; ?>
                </div>
            <?php endif; ?>

            <div class="room-list">
                <?php
                if (!empty($rooms) && is_array($rooms)): ?>
                    <?php
                    foreach ($rooms as $room): ?>
                        <article class="room-card">
                            <h2>
                                <a href="/room/<?= urlencode($room->id ?? '') ?>">
                                    <?= htmlspecialchars($room->name) ?>
                                </a>
                            </h2>
                            <p><?= nl2br(
                                        htmlspecialchars(
                                                $room->description,
                                        )
                                ) ?></p>
                        </article>
                    <?php
                    endforeach; ?>
                <?php
                else: ?>
                    <p class="empty-hint">Noch keine Räume vorhanden.</p>
                <?php
                endif; ?>
            </div>
        </div>
    </div>


<?php
require_once(__DIR__ . '/footer.phtml');
?>