<file name=0 path=room.phtml><?php

require_once(__DIR__ . '/header.phtml');
?>

    <div class="rooms-wrapper">
        <div class="rooms room-detail">
            <div class="room-titlebar">
                <h1>Raum: <?= htmlspecialchars($room['name']) ?></h1>
                <a href="/rooms" class="back-link" aria-label="Zurück zu den Räumen">← Zurück zu den Räumen</a>
            </div>
            <?php
            if (!empty($room['description'])): ?>
                <p class="room-desc"><?= htmlspecialchars($room['description']) ?></p>
            <?php
            endif; ?>

            <?php
            $items = $reminders ?? ($room['reminders'] ?? []);
            ?>

            <h2>Aktuelle Timer</h2>
            <?php
            if (!empty($items)): ?>
                <ul class="reminder-list">
                    <?php
                    foreach ($items as $t): ?>
                        <li class="reminder-card">
                            <div class="reminder-header">
                                <h3><?= htmlspecialchars($t['title'] ?? '') ?></h3>
                                <form action="/reminder-delete" method="post" class="delete-form">
                                    <input type="hidden" name="reminder_id" value="<?= $t['id'] ?>">
                                    <input type="hidden" name="room_id" value="<?= $room['id'] ?>">
                                    <button type="submit" class="delete-btn">✕</button>
                                </form>
                            </div>

                            <div class="reminder-body">
                                <p><strong>Endet in:</strong>
                                    <?php
                                    if (!empty($t['due_at'])) {
                                        $now = new DateTime();
                                        $dt = $t['due_at'] instanceof DateTime ? $t['due_at'] : new DateTime(
                                                $t['due_at']
                                        );
                                        if ($dt > $now) {
                                            $difference = $now->diff($dt);
                                            echo $difference->format('%a Tage, %h Std, %i Min');
                                        } else {
                                            echo 'abgelaufen';
                                        }
                                        echo ' (am ' . htmlspecialchars($dt->format('d.m.Y H:i')) . ')';
                                    }
                                    ?>
                                </p>
                                <p><?= nl2br(htmlspecialchars($t['notes'] ?? '')) ?></p>
                            </div>
                        </li>
                    <?php
                    endforeach; ?>
                </ul>
            <?php
            else: ?>
                <p>Keine Einträge vorhanden.</p>
            <?php
            endif; ?>

            <h2>Neuen Reminder hinzufügen</h2>
            <form action="/reminder-submit" method="post">
                <input type="hidden" name="room_id" value="<?= $room['id'] ?>">

                <div>
                    <label for="reminder_title">Titel</label>
                    <input type="text" id="reminder_title" name="reminder_title" required>
                </div>

                <div>
                    <label for="reminder_notes">Notizen</label>
                    <textarea id="reminder_notes" name="reminder_notes" rows="4"></textarea>
                </div>

                <div>
                    <label for="reminder_due_at">Fällig am</label>
                    <input type="datetime-local" id="reminder_due_at" name="reminder_due_at"
                           value="<?= date('Y-m-d\\TH:i', time() + 300) ?>" required>
                </div>

                <div>
                    <label for="reminder_repeat_rules">Wiederholen</label>
                    <select id="reminder_repeat_rules" name="reminder_repeat_rules">
                        <option value="none">Keine Wiederholung</option>
                        <option value="daily">Täglich</option>
                        <option value="weekly">Wöchentlich</option>
                        <option value="monthly">Monatlich</option>
                    </select>
                </div>

                <div>
                    <label for="reminder_priority">Priorität</label>
                    <select id="reminder_priority" name="reminder_priority">
                        <option value="low">Niedrig</option>
                        <option value="medium">Mittel</option>
                        <option value="high">Hoch</option>
                    </select>
                </div>

                <div>
                    <label for="reminder_status">Status</label>
                    <select id="reminder_status" name="reminder_status">
                        <option value="open">Offen</option>
                        <option value="done">Erledigt</option>
                    </select>
                </div>

                <input type="hidden" name="reminder_created_at" value="<?= date('Y-m-d H:i:s') ?>">

                <button type="submit">Reminder anlegen</button>

            </form>
        </div>
    </div>

<?php
require_once(__DIR__ . '/footer.phtml');
?></file>